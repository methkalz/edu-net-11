# ุชุชุจุน ุขุฎุฑ ุชุณุฌูู ุฏุฎูู - ุฏููู ุงูุฅุนุฏุงุฏ ูุงูุชุทุจูู

## ๐ ููุฎุต ุงูููุฒุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูุชุชุจุน ุขุฎุฑ ุชุณุฌูู ุฏุฎูู ูููุณุชุฎุฏููู ูุน ุงูููุฒุงุช ุงูุชุงููุฉ:

### โจ ุงูููุฒุงุช ุงููุถุงูุฉ

1. **ุชุณุฌูู ุขุฎุฑ ุฏุฎูู**: ุชุณุฌูู ุทุงุจุน ุฒููู ูุขุฎุฑ ุฏุฎูู
2. **ุนุฏุงุฏ ูุฑุงุช ุงูุฏุฎูู**: ุชุชุจุน ุนุฏุฏ ูุฑุงุช ุชุณุฌูู ุงูุฏุฎูู
3. **ุฅุญุตุงุฆูุงุช ูุชูุฏูุฉ**: ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุดุทูู ููููุงู/ุฃุณุจูุนูุงู/ุดูุฑูุงู
4. **ุชุญุฏูุฏ ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู**: ุงููุณุชุฎุฏููู ุงูุฐูู ูู ูุณุฌููุง ุฏุฎูู ุจุนุฏ
5. **ูุงุฌูุฉ ูุญุฏุซุฉ**: ุนุฑุถ ุขุฎุฑ ุชุณุฌูู ุฏุฎูู ูู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

## ๐๏ธ ูุชุทูุจุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฎุทูุฉ 1: ุชุดุบูู SQL Script

ูู ุจุชุดุบูู ุงูููู `add-login-tracking-columns.sql` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ุฅุถุงูุฉ ุฃุนูุฏุฉ ุชุชุจุน ุชุณุฌูู ุงูุฏุฎูู
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS last_login_at TIMESTAMP WITH TIME ZONE;

ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS login_count INTEGER DEFAULT 0;

-- ุฅุถุงูุฉ ููุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
CREATE INDEX IF NOT EXISTS idx_profiles_last_login_at 
ON profiles(last_login_at);

-- ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
UPDATE profiles 
SET login_count = 0 
WHERE login_count IS NULL;
```

### ุฎุทูุฉ 2: ุฅูุดุงุก RPC Function (ุงุฎุชูุงุฑู)

```sql
CREATE OR REPLACE FUNCTION update_user_login(
  p_user_id UUID,
  p_login_timestamp TIMESTAMP WITH TIME ZONE,
  p_login_count INTEGER
) RETURNS VOID AS $$
BEGIN
  UPDATE profiles 
  SET 
    last_login_at = p_login_timestamp,
    login_count = p_login_count
  WHERE user_id = p_user_id;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

## ๐ ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### 1. Hook ุฌุฏูุฏ: `src/hooks/useLoginTracking.ts`
- ุฅุฏุงุฑุฉ ุดุงููุฉ ูุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู
- ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
- ุชูุณูู ุนุฑุถ ุขุฎุฑ ุชุณุฌูู ุฏุฎูู
- ุชุญุฏูุฏ ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู

### 2. ุชุญุฏูุซ `src/hooks/useAuth.tsx`
- ุชุณุฌูู ุทุงุจุน ุฒููู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ุงููุงุฌุญ
- ุชุณุฌูู ุงูุฃุญุฏุงุซ ูู ูุธุงู ุงููุฑุงุฌุนุฉ (Audit)
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุชุชุจุน ุจุฏูู ุงูุชุฃุซูุฑ ุนูู ุชุณุฌูู ุงูุฏุฎูู

### 3. ุชุญุฏูุซ `src/components/UserRoleManager.tsx`
- ุฅุถุงูุฉ ุนููุฏ "ุขุฎุฑ ุชุณุฌูู ุฏุฎูู"
- ุนุฑุถ ุนุฏุฏ ูุฑุงุช ุชุณุฌูู ุงูุฏุฎูู
- ูุคุดุฑุงุช ุจุตุฑูุฉ ูููุณุชุฎุฏููู ุงููุดุทูู/ุบูุฑ ุงููุดุทูู

### 4. Edge Function: `supabase/functions/update-user-login/index.ts`
- ุฏุงูุฉ ุขููุฉ ูุชุญุฏูุซ ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู
- ูุนุงูุฌุฉ CORS ูุงูุฃุฎุทุงุก

### 5. SQL Script: `add-login-tracking-columns.sql`
- ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ
- ุฅูุดุงุก ุงูููุงุฑุณ
- ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ

## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูู ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู:

```tsx
// ูุชู ุนุฑุถ ุขุฎุฑ ุชุณุฌูู ุฏุฎูู ุชููุงุฆูุงู
<span className={`text-xs px-2 py-1 rounded-full ${
  !user.last_login_at 
    ? 'bg-red-100 text-red-700'     // ูู ูุณุฌู ุฏุฎูู ุจุนุฏ
    : 'bg-green-100 text-green-700' // ูุดุท
}`}>
  {formatLastLogin(user.last_login_at, user.created_at)}
</span>
```

### ุงุณุชุฎุฏุงู Hook ุงูุชุชุจุน:

```tsx
const { 
  formatLastLogin, 
  getNeverLoggedInUsers, 
  getInactiveUsers,
  stats 
} = useLoginTracking();

// ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
console.log(`ูุณุชุฎุฏููู ูุดุทูู ุงูููู: ${stats.activeToday}`);
console.log(`ูู ูุณุฌููุง ุฏุฎูู ูุทููุงู: ${stats.neverLoggedIn}`);

// ุงูุญุตูู ุนูู ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู
const inactiveUsers = getInactiveUsers(30); // ุขุฎุฑ 30 ููู
```

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุชุงุญุฉ

- **ุฅุฌูุงูู ุงููุณุชุฎุฏููู**: ุงูุนุฏุฏ ุงูููู
- **ูุดุทูู ุงูููู**: ุณุฌููุง ุฏุฎูู ุฎูุงู 24 ุณุงุนุฉ
- **ูุดุทูู ูุฐุง ุงูุฃุณุจูุน**: ุณุฌููุง ุฏุฎูู ุฎูุงู 7 ุฃูุงู
- **ูุดุทูู ูุฐุง ุงูุดูุฑ**: ุณุฌููุง ุฏุฎูู ุฎูุงู 30 ููู
- **ูู ูุณุฌููุง ุฏุฎูู ุจุนุฏ**: ูู ูุณุฌููุง ุฏุฎูู ูุทููุงู

## ๐ก๏ธ ุงูุฃูุงู ูุงููุฑุงุฌุนุฉ

- ุฌููุน ุนูููุงุช ุชุณุฌูู ุงูุฏุฎูู ุชูุณุฌู ูู ูุธุงู ุงููุฑุงุฌุนุฉ
- ูุนุฑู ุงููุณุชุฎุฏู ูุทุงุจุน ุฒููู ููู ุนูููุฉ
- ูุง ูุคุซุฑ ูุดู ุงูุชุชุจุน ุนูู ุชุณุฌูู ุงูุฏุฎูู
- ุจูุงูุงุช ูุดูุฑุฉ ููุญููุฉ

## ๐ฎ ููุฒุงุช ูุณุชูุจููุฉ

1. **ุชูุจููุงุช ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู**
2. **ุชูุงุฑูุฑ ุงุณุชุฎุฏุงู ุชูุตูููุฉ**
3. **ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต**
4. **ุชุญูููุงุช ูุชูุฏูุฉ ูุฃููุงุท ุงูุงุณุชุฎุฏุงู**

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุฌุจ ุชุดุบูู SQL Script ุฃููุงู** ูุจู ุงุณุชุฎุฏุงู ุงูููุฒุงุช
2. **ุงููุธุงู ูุนูู ุจุฏูู ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ** (ูุถุน ุขูู)
3. **ุฌููุน ุงูุฃุฎุทุงุก ุชูุณุฌู** ูู ูุธุงู ุงูุณุฌูุงุช
4. **ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก** ุงูุญุงูู ูููุธุงู

---

โ **ุชู ุงูุงูุชูุงุก ูู ุชุทุจูู ูุธุงู ุชุชุจุน ุขุฎุฑ ุชุณุฌูู ุฏุฎูู ุจูุฌุงุญ!**