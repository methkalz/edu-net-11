<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‡ÙŠÙƒÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø± Ø§Ù„ÙƒØ§Ù…Ù„ - 17 Ù‚Ø³Ù…</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 3px solid #667eea;
        }
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.5em;
            color: #667eea;
        }
        .section {
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            background: linear-gradient(to bottom, #f8f9ff 0%, #ffffff 100%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e7ff;
        }
        .section-title {
            color: #1e40af;
            font-size: 1.5em;
            font-weight: bold;
        }
        .section-meta {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .badge {
            background: #667eea;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .topic {
            border-right: 4px solid #10b981;
            padding: 20px;
            margin: 20px 0 20px 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .topic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .topic-title {
            color: #065f46;
            font-size: 1.2em;
            font-weight: bold;
        }
        .lesson {
            padding: 12px 20px;
            margin: 10px 0 10px 50px;
            background: linear-gradient(to left, #fef3c7 0%, #fef9e7 100%);
            border-radius: 8px;
            border-right: 3px solid #f59e0b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        .lesson:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        .lesson-title {
            color: #92400e;
            font-weight: 500;
        }
        .lesson-meta {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 0.85em;
        }
        .id-badge {
            background: #f3f4f6;
            color: #6b7280;
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.75em;
        }
        .order-badge {
            background: #dbeafe;
            color: #1e40af;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
        }
        .date-badge {
            background: #f3e8ff;
            color: #7c3aed;
            padding: 4px 10px;
            border-radius: 6px;
        }
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
        }
        .filter-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 18px;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }
        .filter-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .problem-box {
            background: #fee2e2;
            border: 2px solid #dc2626;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        .problem-box h3 {
            color: #991b1b;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .problem-list {
            list-style: none;
            padding-right: 20px;
        }
        .problem-list li {
            padding: 8px 0;
            padding-right: 25px;
            position: relative;
        }
        .problem-list li:before {
            content: "âš ï¸";
            position: absolute;
            right: 0;
        }
        .solution-box {
            background: #d1fae5;
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        .solution-box h3 {
            color: #065f46;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .filters {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Ù‡ÙŠÙƒÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø± Ø§Ù„ÙƒØ§Ù…Ù„</h1>
            <p style="color: #6b7280; font-size: 1.1em; margin-top: 10px;">
                Ù…Ø±ØªØ¨ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ | Ù…Ø¹ Ø£Ø±Ù‚Ø§Ù… Order Index Ø§Ù„ÙØ¹Ù„ÙŠØ©
            </p>
            
            <div class="stats" id="stats">
                <div class="stat-card">
                    <span class="stat-number">17</span>
                    <span class="stat-label">Ù‚Ø³Ù…</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">74</span>
                    <span class="stat-label">Ù…ÙˆØ¶ÙˆØ¹</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">277</span>
                    <span class="stat-label">Ø¯Ø±Ø³ Ù†Ø´Ø·</span>
                </div>
            </div>
        </div>

        <div class="filters">
            <input 
                type="text" 
                id="searchInput" 
                class="filter-input" 
                placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ØŒ Ø£Ùˆ Ø§Ù„Ø¯Ø±ÙˆØ³..."
            >
            <input 
                type="text" 
                id="idSearch" 
                class="filter-input" 
                placeholder="ğŸ”¢ Ø§Ø¨Ø­Ø« Ø¨Ù€ ID..."
            >
        </div>

        <div class="loading" id="loading">
            â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
        </div>

        <div id="content" style="display: none;"></div>

        <div class="problem-box">
            <h3>âš ï¸ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ÙƒØªØ´ÙØ© ÙÙŠ order_index</h3>
            <ul class="problem-list">
                <li>Ù…Ø¹Ø¸Ù… Ø§Ù„Ø¯Ø±ÙˆØ³ ØªØ´ØªØ±Ùƒ ÙÙŠ Ù†ÙØ³ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ØŒ Ù…Ù…Ø§ ÙŠØµØ¹Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚</li>
                <li>Ù‚ÙŠÙ… order_index ØºÙŠØ± Ù…ØªØ³Ù„Ø³Ù„Ø© (ØªÙˆØ¬Ø¯ ÙØ¬ÙˆØ§Øª ÙƒØ¨ÙŠØ±Ø©)</li>
                <li>Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ù„Ù‡Ø§ order_index = 0</li>
                <li>Ø¨Ø¹Ø¶ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù„Ù‡Ø§ Ù‚ÙŠÙ… order_index Ù…Ø±ØªÙØ¹Ø© Ø¬Ø¯Ø§Ù‹ (100ØŒ 101ØŒ 514ØŒ 515)</li>
            </ul>
        </div>

        <div class="solution-box">
            <h3>ğŸ”§ Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­</h3>
            <ol style="padding-right: 25px;">
                <li><strong>Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> ØªØ´ØºÙŠÙ„ SQL script Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø´ÙƒÙ„ Ù…ØªØ³Ù„Ø³Ù„ (0, 1, 2...)</li>
                <li><strong>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯:</strong> ØªØ­Ø¯ÙŠØ« Grade11LessonForm.tsx Ù„Ø­Ø³Ø§Ø¨ order_index ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                <li><strong>ÙØ±Ø² Ø«Ø§Ù†ÙˆÙŠ:</strong> Ø¥Ø¶Ø§ÙØ© ÙØ±Ø² Ø¨Ù€ created_at ÙÙŠ Ø­Ø§Ù„ ØªØ³Ø§ÙˆÙŠ order_index</li>
            </ol>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.57.2/+esm';
        
        const SUPABASE_URL = 'https://swlwhjnwycvjdhgclwlx.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3bHdoam53eWN2amRoZ2Nsd2x4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMDU4MzgsImV4cCI6MjA3MDg4MTgzOH0.whMWEn_UIrxBa2QbK1leY9QTr1jeTnkUUn3g50fAKus';
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        async function loadData() {
            try {
                console.log('Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                const { data: sections, error: sectionsError } = await supabase
                    .from('grade11_sections')
                    .select('*')
                    .order('created_at', { ascending: true })
                    .order('order_index', { ascending: true });
                
                if (sectionsError) throw sectionsError;
                console.log('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:', sections?.length);

                // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹
                const { data: topics, error: topicsError } = await supabase
                    .from('grade11_topics')
                    .select('*')
                    .order('created_at', { ascending: true })
                    .order('order_index', { ascending: true });
                
                if (topicsError) throw topicsError;
                console.log('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:', topics?.length);

                // Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·
                const { data: lessons, error: lessonsError } = await supabase
                    .from('grade11_lessons')
                    .select('*')
                    .eq('is_active', true)
                    .order('created_at', { ascending: true })
                    .order('order_index', { ascending: true });
                
                if (lessonsError) throw lessonsError;
                console.log('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±ÙˆØ³:', lessons?.length);

                return organizeData(sections, topics, lessons);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: #dc2626; padding: 30px; background: #fee2e2; border-radius: 12px;">
                        <h3>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        <p style="margin-top: 15px; font-size: 0.9em;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                        <p style="margin-top: 10px; font-size: 0.85em; color: #991b1b;">${error.message}</p>
                    </div>
                `;
                return null;
            }
        }

        function organizeData(sections, topics, lessons) {
            return sections.map(section => ({
                id: section.id,
                title: section.title,
                order: section.order_index,
                created_at: section.created_at,
                topics: topics
                    .filter(topic => topic.section_id === section.id)
                    .map(topic => ({
                        id: topic.id,
                        title: topic.title,
                        order: topic.order_index,
                        created_at: topic.created_at,
                        lessons: lessons
                            .filter(lesson => lesson.topic_id === topic.id)
                            .map(lesson => ({
                                id: lesson.id,
                                title: lesson.title,
                                order: lesson.order_index,
                                created_at: lesson.created_at
                            }))
                    }))
            }));
        }


        function formatDate(dateString) {
            if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG');
        }

        function renderContent(sections) {
            if (!sections || sections.length === 0) return;

            let html = '';
            let sectionNumber = 1;

            sections.forEach(section => {
                const topics = section.topics || [];
                const totalLessons = topics.reduce((sum, topic) => sum + (topic.lessons?.length || 0), 0);

                html += `
                    <div class="section">
                        <div class="section-header">
                            <div>
                                <div class="section-title">
                                    ${sectionNumber}. ${section.title}
                                </div>
                                <div style="margin-top: 8px; font-size: 0.85em; color: #6b7280;">
                                    <span class="id-badge">${section.id}</span>
                                </div>
                            </div>
                            <div class="section-meta">
                                <span class="badge">ØªØ±ØªÙŠØ¨: ${section.order}</span>
                                <span class="badge">${topics.length} Ù…ÙˆØ§Ø¶ÙŠØ¹</span>
                                <span class="badge">${totalLessons} Ø¯Ø±Ø³</span>
                                <span class="date-badge">${formatDate(section.created_at)}</span>
                            </div>
                        </div>
                `;

                let topicNumber = 1;
                topics.forEach(topic => {
                    html += `
                        <div class="topic">
                            <div class="topic-header">
                                <div>
                                    <div class="topic-title">
                                        ${sectionNumber}.${topicNumber} ${topic.title}
                                    </div>
                                    <div style="margin-top: 8px; font-size: 0.85em;">
                                        <span class="id-badge">${topic.id}</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <span class="order-badge">ØªØ±ØªÙŠØ¨: ${topic.order}</span>
                                    <span class="badge">${topic.lessons.length} Ø¯Ø±Ø³</span>
                                    <span class="date-badge">${formatDate(topic.created_at)}</span>
                                </div>
                            </div>
                    `;

                    topic.lessons.forEach((lesson, lessonIndex) => {
                        html += `
                            <div class="lesson">
                                <div class="lesson-title">
                                    ${sectionNumber}.${topicNumber}.${lessonIndex + 1} ${lesson.title}
                                </div>
                                <div class="lesson-meta">
                                    <span class="id-badge">${lesson.id}</span>
                                    <span class="order-badge">ØªØ±ØªÙŠØ¨: ${lesson.order}</span>
                                    <span class="date-badge">${formatDate(lesson.created_at)}</span>
                                </div>
                            </div>
                        `;
                    });

                    html += `</div>`;
                    topicNumber++;
                });

                html += `</div>`;
                sectionNumber++;
            });

            document.getElementById('content').innerHTML = html;
            document.getElementById('content').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
        function setupFilters() {
            const searchInput = document.getElementById('searchInput');
            const idSearch = document.getElementById('idSearch');

            function filterContent() {
                const searchTerm = searchInput.value.toLowerCase();
                const idTerm = idSearch.value.toLowerCase();

                const sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    const text = section.textContent.toLowerCase();
                    const matchesSearch = !searchTerm || text.includes(searchTerm);
                    const matchesId = !idTerm || text.includes(idTerm);
                    
                    section.style.display = (matchesSearch && matchesId) ? 'block' : 'none';
                });
            }

            searchInput.addEventListener('input', filterContent);
            idSearch.addEventListener('input', filterContent);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        loadData().then(sections => {
            if (sections) {
                renderContent(sections);
                setupFilters();
            }
        });
    </script>
</body>
</html>